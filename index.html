<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digimon RPG</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="data.js"></script>
    <script type="module" src="storage.js"></script>
    <script type="module" src="digimon.js"></script>
    <script type="module" src="equipment.js"></script>
    <script type="module" src="battle.js"></script>
    <script type="module" src="ui.js"></script>
</head>
<body>
    <div id="game-container">
        <div id="menu-screen">
            <h2>Digimon Status</h2>
            <p id="bit-amount">BIT: 0</p> | <p id="jogress-shards">Jogress Shards: 0</p>
            <p>Active Digimon: <span id="menu-player-name">None</span> (Level: <span id="menu-player-level">0</span>)</p>
            <p id="afk-status">Not training</p>
            <div id="digimon-slots"></div>
            <select id="enemy-stage-select">
                <option value="Rookie">Rookie</option>
                <option value="Champion">Champion</option>
                <option value="Ultimate">Ultimate</option>
                <option value="Mega">Mega</option>
                <option value="Ultra">Ultra</option>
            </select>
            <p>Combat Mode: 
                <select id="combat-mode-select" onchange="toggleCombatMode()">
                    <option value="charging">Charging Bar</option>
                    <option value="precision">Precision Strike</option>
                </select>
            </p>
            <div>
                <button onclick="startBattle(false)">Start Normal Fight</button>
                <button onclick="startBattle(true)">Start Boss Fight</button>
            </div>
            <div>
                <button onclick="goToShop()">Go to Shop</button>
                <button onclick="toggleJogressMenu()">Jogress Menu</button>
                <button onclick="showEquipMenu()">Manage Equipment</button>
                <button onclick="resetGame()">Reset Game</button>
                <button onclick="saveProgress(true)">Auto-Save Game</button>
                <button onclick="exportSave()">Export Save</button>
                <input type="file" id="load-game-input" accept=".json">
                <button onclick="handleLoadGame(document.getElementById('load-game-input').files[0])">Import Save</button>
            </div>
        </div>
        <div id="jogress-screen">
            <h2>Jogress Menu</h2>
            <p>Select two Digimon to Jogress:</p>
            <select id="jogress-digimon1">
                <option value="">Select First Digimon</option>
            </select>
            <select id="jogress-digimon2">
                <option value="">Select Second Digimon</option>
            </select>
            <div>
                <button onclick="performJogress()">Perform Jogress</button>
                <button onclick="showMenu()">Back to Menu</button>
            </div>
        </div>
        <div id="equip-manage-screen">
            <h2>Equipment Management</h2>
            <div id="equip-manage-content"></div>
            <button onclick="showMenu()">Back to Menu</button>
        </div>
        <div id="battle-screen">
            <div class="battle-interface">
                <div class="stats">
                    <h3>Player: <span id="player-name">None</span></h3>
                    <img id="player-sprite" src="" alt="Player Digimon">
                    <p>Level: <span id="player-level">0</span></p>
                    <p>HP: <span id="player-hp">0</span>/<span id="player-max-hp">0</span> <span id="player-hp-bonus"></span></p>
                    <p>Attack: <span id="player-attack">0</span> <span id="player-attack-bonus"></span></p>
                    <p>XP: <span id="player-xp">0</span>/<span id="player-xp-next">0</span></p>
                    <div id="xp-bar"><div id="xp-progress"></div></div>
                </div>
                <div class="stats">
                    <h3>Opponent: <span id="opponent-name">None</span></h3>
                    <img id="opponent-sprite" src="" alt="Opponent Digimon">
                    <p>Level: <span id="opponent-level">0</span></p>
                    <p>HP: <span id="opponent-hp">0</span>/<span id="opponent-max-hp">0</span></p>
                    <p>Attack: <span id="opponent-attack">0</span></p>
                </div>
            </div>
            <input type="checkbox" id="heal-toggle" onchange="toggleHealing()"> Heal on Victory (1 BIT = 5 HP)
            <div id="battle-log"></div>
            <div id="timing-bar">
                <div class="power-line power-line-20"></div>
                <div class="power-line power-line-40"></div>
                <div class="power-line power-line-60"></div>
                <div class="power-line power-line-80"></div>
                <div class="power-line power-line-90"></div>
                <div class="power-line power-line-95"></div>
                <div id="marker"></div>
            </div>
            <div id="precision-field">
                <div id="target"></div>
                <div id="target2"></div>
            </div>
            <div id="attack-button-container">
                <button id="attack-button" onclick="attack()">Attack</button>
            </div>
            <button onclick="endBattle()">Menu</button>
        </div>
        <div id="shop-screen">
            <h2>Shop</h2>
            <p id="shop-bit-amount">BIT: 0</p> | <p id="shop-jogress-shards">Jogress Shards: 0</p>
            <div class="shop-item">
                <p>Jogress Shard (2000 BIT)</p>
                <button onclick="buyJogressShards()">Buy</button>
            </div>
            <div class="shop-item">
                <p>Attack Boost (+1) (10000 BIT)</p>
                <button onclick="buyAttackBoost()">Buy One</button>
                <button onclick="buyAttackBoostBulk('half')">Buy Half</button>
                <button onclick="buyAttackBoostBulk('all')">Buy All</button>
            </div>
            <div class="shop-item">
                <p>HP Boost (+5) (10000 BIT)</p>
                <button onclick="buyHPBoost()">Buy One</button>
                <button onclick="buyHPBoostBulk('half')">Buy Half</button>
                <button onclick="buyHPBoostBulk('all')">Buy All</button>
            </div>
            <button onclick="showMenu()">Back to Menu</button>
        </div>
    </div>
</body>
</html>